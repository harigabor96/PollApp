<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>PollApp</title>
    <link rel="shortcut icon" type="image/png" th:href="@{../favicon.png}"/>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">
        // Load the Visualization API and the corechart package.
        google.charts.load('current', {'packages':['corechart']});

        // Set a callback to run when the Google Visualization API is loaded.
        google.charts.setOnLoadCallback(drawChart);

        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart() {

            // Create the data table.
            let data = new google.visualization.DataTable();
            data.addColumn('string', 'Answer');
            data.addColumn('number', 'Votes');
            data.addColumn({type:'string', role:'style'});
            data.addRows([
                /*[# th:each="row : ${chartData}"]*/
                   [[${row}]],
                /*[/]*/
           ]);

            // Set chart options
            let options = {
                width: 450,
                height: 350,
                legend:'none',
                allowHtml: true,
                backgroundColor: '#304257',
                chartArea: {
                    width: '80%',
                    height: '80%'
                },
                hAxis: {
                    textStyle: {
                        color: '#d5e1ef'
                    }
                },
                vAxis: {
                    baselineColor: '#d5e1ef',

                    textStyle: {
                        color: '#304257'
                    },
                    gridlines: {
                        color: '#304257'
                    },
                    minorGridlines: {
                        color: '#304257'
                    }
                }
            };

            // Instantiate and draw our chart, passing in some options.
            let chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
            chart.draw(data, options);
        }
    </script>
</head>
<body>
<nav>
    <div class="nav-grid-container">
        <div class="grid-item-nav-title">
            PollApp
        </div>
        <img class="grid-item-nav-img" th:src="@{./images/logo_inverted_small.png}">
        <a class="grid-item-nav-polls" href="/poll-list">View Polls</a>
        <a class="grid-item-nav-create" href="/poll-management/creation">Create a Poll</a>
        <a class="grid-item-sign-out-link" href="/logout">Sign Out</a>
    </div>
</nav>
<h1>Poll Results</h1>
<b><span th:text="${results.question}"></span></b>
<div id="chart_div"></div>
<table>
    <tr>
        <td><b><label>Question</label></b></td>
        <td><b><label>Votes</label></b></td>
    </tr>
    <tr th:each="result : ${results.answers}">
        <td th:text="${result.answer}"/>
        <td style="text-align: center" th:text="${result.voteCount}"/>
    </tr>
</table>
<form th:if="${userRole == 1 || userId == results.creatorId}">
    <button formaction="/poll-management/delete" formmethod="post"
            name="questionId" th:value="${results.questionId}">Delete
    </button>
</form>
<h3 style="color:red" th:if="${errorMsg != null}" th:text="${errorMsg}"/>
</body>
</html>